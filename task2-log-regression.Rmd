---
title: "task2-logregression"
author: "Carmen Galaz-Garc√≠a"
date: "1/29/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning=FALSE)

library(tidyverse)
library(broom)
library(kableExtra)  # create nice tables

```



```{r}
# --- DATA SELECTION ---- 
raw_palmetto <- read_csv("palmetto.csv")

palmetto <- raw_palmetto%>% 
  select(species, height:green_lvs) %>% 
  mutate(species = case_when( species==1 ~ "serenoa repens",
                              species==2 ~ "sabal etonia"))

palmetto$species<- as.factor(palmetto$species) # convert to factor
#levels(palmetto$species)    # check factor levels
```


```{r}
# --- GRAPH 1: CANOPY DIMENSIONS ---
ggplot(data=palmetto, aes(x=length, y=width))+
  geom_point( cex=0.3, alpha=0.2)+
  facet_wrap(~species)+
  labs( x= "length (cm)",
        y= "width (cm)"
       #title = expression(paste(
        # "Canopy dimensions in ",
        # italic("sabal etonia"),
        # " and ",
        # italic("serenoa repens")))
        )+
  theme_light()
  
```

**Figure 1.** Relationship between widest length of the canopy (cm) and widest width of the canopy perpendicular to the canopy length (cm) of the palmetto plant species *sabal etonia* and *serenoa repens*. Each point indicates measurements of an individual plant. Data: Abrahamson (2019)


```{r}
# --- GRAPH 1: NUMBER OF LEAVES HISTOGRAM  ---
ggplot(data=palmetto, aes(x=green_lvs))+
  geom_histogram(binwidth = 1)+
  facet_wrap(~species)+
  labs( x = "number of green leaves (n)",
        y = "count")+
  theme_light()
```

**Figure 2.** Histograms of number of green leaves (n) in the palmetto plant species *sabal etonia* and *serenoa repens*. Data: Abrahamson (2019)

```{r}
# --- GRAPH 3: 
summary_palmetto <- palmetto %>% 
  group_by(species) %>% 
  summarize(mean = mean(height, na.rm=TRUE),
            sd = sd(height, na.rm=TRUE),
            #median = median(weight, na.rm=TRUE),
            n = n()
            )

ggplot(data=palmetto, aes(x=species, y=height))+
  geom_boxplot()+
  geom_jitter(color="forestgreen", size=0.4, alpha=0.2) +
  labs(y = "height (cm)")

```

**Figure 3.** Height (cm) of the palmetto plant species *sabal etonia* and *serenoa repens*. Each green point indicates the height of an individual plant. 
Box endpoints indicate the 25th and 75th percentile values, the black line within the box indicate the median for each species. 
Black points at the end of the boxes indicate possible outliers. 
Data: Abrahamson (2019)

## Binary logistic equation


```{r}
blr_palmetto <- glm(species ~ height + length + width + green_lvs, 
                            data = palmetto,
                            family = "binomial") #specify model is BLR

blr_palmetto
summary(blr_palmetto)
tidy(blr_palmetto)
```
```{r}
results_blr <- blr_palmetto %>% 
  broom::augment(type.predict="response") %>% # calculate probability for each outcome
  select(species,.fitted) %>% 
  mutate(classification = case_when( .fitted>0.5 & species=="serenoa repens"~ "True",
                                     .fitted<=0.5 & species=="serenoa repens"~ "False",
                                     .fitted>0.5 & species=="sabal etonia"~ "False",
                                     .fitted<=0.5 & species=="sabal etonia"~ "True")) %>% 
  count(species, classification) %>% 
  mutate(percentage = case_when( 
    species == "sabal etonia" ~ scales::percent(n/(454+5701),accuracy = 0.01),
    species == "serenoa repens" ~ scales::percent(n/(564+5548),accuracy = 0.01))
    ) %>% 
  kable( col.names = c("Species", 
                        "Correctly classified by model", 
                        "Count",
                       "Percentage") 
                         ) %>% 
   kable_styling(full_width = FALSE)
results_blr
```
```{r}
    species == "sabal etonia" ~ scales::percent(round(n/6245*100,2)),
    species == "serenoa repens" ~ scales::percent(round(n/6215,2)))
```

